<!-- Advanced Network Configuration Section -->
<div class="space-y-6">
    <!-- Page Header -->
    <div class="mb-8">
        <h2 class="text-2xl text-neutral-900 mb-2 flex items-center">
            <i class="fa-solid fa-network-wired text-neutral-700 mr-3"></i>
            Advanced Network Configuration
        </h2>
        <p class="text-neutral-600">Manage VLANs, NAT rules, firewall rules, static routes, and network bridges</p>
    </div>

    <!-- VLAN Configuration -->
    <section id="vlan-section" class="bg-white rounded-lg border border-neutral-200">
        <div class="px-6 py-4 border-b border-neutral-200">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <h3 class="text-lg text-neutral-900">VLAN Configuration</h3>
                    <div class="flex items-center space-x-2">
                        <div class="w-2 h-2 bg-neutral-400 rounded-full"></div>
                        <span id="vlan-count" class="text-sm text-neutral-600">0 VLANs</span>
                    </div>
                </div>
                <div class="flex items-center space-x-3">
                    <button id="add-vlan-btn" class="bg-neutral-600 hover:bg-neutral-700 text-white px-4 py-2 rounded-lg text-sm">
                        <i class="fa-solid fa-plus mr-2"></i>Add VLAN
                    </button>
                </div>
            </div>
        </div>
        <div class="overflow-x-auto">
            <table class="w-full">
                <thead class="bg-neutral-50">
                    <tr>
                        <th class="px-6 py-3 text-left text-xs text-neutral-500 uppercase tracking-wider">VLAN ID</th>
                        <th class="px-6 py-3 text-left text-xs text-neutral-500 uppercase tracking-wider">Name</th>
                        <th class="px-6 py-3 text-left text-xs text-neutral-500 uppercase tracking-wider">Description</th>
                        <th class="px-6 py-3 text-left text-xs text-neutral-500 uppercase tracking-wider">Priority</th>
                        <th class="px-6 py-3 text-left text-xs text-neutral-500 uppercase tracking-wider">Status</th>
                        <th class="px-6 py-3 text-left text-xs text-neutral-500 uppercase tracking-wider">Actions</th>
                    </tr>
                </thead>
                <tbody id="vlan-table-body" class="bg-white divide-y divide-neutral-200">
                    <!-- VLAN rows will be dynamically added here -->
                </tbody>
            </table>
        </div>
    </section>

    <!-- NAT Rules -->
    <section id="nat-rules-section" class="bg-white rounded-lg border border-neutral-200">
        <div class="px-6 py-4 border-b border-neutral-200">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <h3 class="text-lg text-neutral-900">NAT Rules</h3>
                    <div class="flex items-center space-x-2">
                        <div class="w-2 h-2 bg-neutral-400 rounded-full"></div>
                        <span id="nat-rules-count" class="text-sm text-neutral-600">0 rules</span>
                    </div>
                </div>
                <div class="flex items-center space-x-3">
                    <button id="add-nat-rule-btn" class="bg-neutral-600 hover:bg-neutral-700 text-white px-4 py-2 rounded-lg text-sm">
                        <i class="fa-solid fa-plus mr-2"></i>Add NAT Rule
                    </button>
                </div>
            </div>
        </div>
        <div class="overflow-x-auto">
            <table class="w-full">
                <thead class="bg-neutral-50">
                    <tr>
                        <th class="px-6 py-3 text-left text-xs text-neutral-500 uppercase tracking-wider">Rule Name</th>
                        <th class="px-6 py-3 text-left text-xs text-neutral-500 uppercase tracking-wider">Type</th>
                        <th class="px-6 py-3 text-left text-xs text-neutral-500 uppercase tracking-wider">Source</th>
                        <th class="px-6 py-3 text-left text-xs text-neutral-500 uppercase tracking-wider">Destination</th>
                        <th class="px-6 py-3 text-left text-xs text-neutral-500 uppercase tracking-wider">Action</th>
                        <th class="px-6 py-3 text-left text-xs text-neutral-500 uppercase tracking-wider">Actions</th>
                    </tr>
                </thead>
                <tbody id="nat-rules-table-body" class="bg-white divide-y divide-neutral-200">
                    <!-- NAT rule rows will be dynamically added here -->
                </tbody>
            </table>
        </div>
    </section>

    <!-- Firewall Rules -->
    <section id="firewall-rules-section" class="bg-white rounded-lg border border-neutral-200">
        <div class="px-6 py-4 border-b border-neutral-200">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <h3 class="text-lg text-neutral-900">Firewall Rules</h3>
                    <div class="flex items-center space-x-2">
                        <div class="w-2 h-2 bg-neutral-400 rounded-full"></div>
                        <span id="firewall-rules-count" class="text-sm text-neutral-600">0 rules</span>
                    </div>
                </div>
                <div class="flex items-center space-x-3">
                    <button id="add-firewall-rule-btn" class="bg-neutral-600 hover:bg-neutral-700 text-white px-4 py-2 rounded-lg text-sm">
                        <i class="fa-solid fa-plus mr-2"></i>Add Firewall Rule
                    </button>
                </div>
            </div>
        </div>
        <div class="overflow-x-auto">
            <table class="w-full">
                <thead class="bg-neutral-50">
                    <tr>
                        <th class="px-6 py-3 text-left text-xs text-neutral-500 uppercase tracking-wider">Rule Name</th>
                        <th class="px-6 py-3 text-left text-xs text-neutral-500 uppercase tracking-wider">Action</th>
                        <th class="px-6 py-3 text-left text-xs text-neutral-500 uppercase tracking-wider">Protocol</th>
                        <th class="px-6 py-3 text-left text-xs text-neutral-500 uppercase tracking-wider">Source</th>
                        <th class="px-6 py-3 text-left text-xs text-neutral-500 uppercase tracking-wider">Destination</th>
                        <th class="px-6 py-3 text-left text-xs text-neutral-500 uppercase tracking-wider">Actions</th>
                    </tr>
                </thead>
                <tbody id="firewall-rules-table-body" class="bg-white divide-y divide-neutral-200">
                    <!-- Firewall rule rows will be dynamically added here -->
                </tbody>
            </table>
        </div>
    </section>

    <!-- Static Routes -->
    <section id="static-routes-section" class="bg-white rounded-lg border border-neutral-200">
        <div class="px-6 py-4 border-b border-neutral-200">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <h3 class="text-lg text-neutral-900">Static Routes</h3>
                    <div class="flex items-center space-x-2">
                        <div class="w-2 h-2 bg-neutral-400 rounded-full"></div>
                        <span id="static-routes-count" class="text-sm text-neutral-600">0 routes</span>
                    </div>
                </div>
                <div class="flex items-center space-x-3">
                    <button id="add-static-route-btn" class="bg-neutral-600 hover:bg-neutral-700 text-white px-4 py-2 rounded-lg text-sm">
                        <i class="fa-solid fa-plus mr-2"></i>Add Static Route
                    </button>
                </div>
            </div>
        </div>
        <div class="overflow-x-auto">
            <table class="w-full">
                <thead class="bg-neutral-50">
                    <tr>
                        <th class="px-6 py-3 text-left text-xs text-neutral-500 uppercase tracking-wider">Destination</th>
                        <th class="px-6 py-3 text-left text-xs text-neutral-500 uppercase tracking-wider">Gateway</th>
                        <th class="px-6 py-3 text-left text-xs text-neutral-500 uppercase tracking-wider">Interface</th>
                        <th class="px-6 py-3 text-left text-xs text-neutral-500 uppercase tracking-wider">Metric</th>
                        <th class="px-6 py-3 text-left text-xs text-neutral-500 uppercase tracking-wider">Actions</th>
                    </tr>
                </thead>
                <tbody id="static-routes-table-body" class="bg-white divide-y divide-neutral-200">
                    <!-- Static route rows will be dynamically added here -->
                </tbody>
            </table>
        </div>
    </section>

    <!-- Network Bridges -->
    <section id="bridges-section" class="bg-white rounded-lg border border-neutral-200">
        <div class="px-6 py-4 border-b border-neutral-200">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <h3 class="text-lg text-neutral-900">Network Bridges</h3>
                    <div class="flex items-center space-x-2">
                        <div class="w-2 h-2 bg-neutral-400 rounded-full"></div>
                        <span id="bridges-count" class="text-sm text-neutral-600">0 bridges</span>
                    </div>
                </div>
                <div class="flex items-center space-x-3">
                    <button id="add-bridge-btn" class="bg-orange-600 hover:bg-orange-700 text-white px-4 py-2 rounded-lg text-sm">
                        <i class="fa-solid fa-plus mr-2"></i>Add Bridge
                    </button>
                </div>
            </div>
        </div>
        <div class="overflow-x-auto">
            <table class="w-full">
                <thead class="bg-neutral-50">
                    <tr>
                        <th class="px-6 py-3 text-left text-xs text-neutral-500 uppercase tracking-wider">Bridge Name</th>
                        <th class="px-6 py-3 text-left text-xs text-neutral-500 uppercase tracking-wider">IP Address</th>
                        <th class="px-6 py-3 text-left text-xs text-neutral-500 uppercase tracking-wider">Member Interfaces</th>
                        <th class="px-6 py-3 text-left text-xs text-neutral-500 uppercase tracking-wider">STP</th>
                        <th class="px-6 py-3 text-left text-xs text-neutral-500 uppercase tracking-wider">Status</th>
                        <th class="px-6 py-3 text-left text-xs text-neutral-500 uppercase tracking-wider">Actions</th>
                    </tr>
                </thead>
                <tbody id="bridges-table-body" class="bg-white divide-y divide-neutral-200">
                    <!-- Bridge rows will be dynamically added here -->
                </tbody>
            </table>
        </div>
    </section>
</div>

<!-- VLAN Popup -->
<div id="vlan-popup" class="popup-overlay" style="position: fixed; inset: 0; background: rgba(0,0,0,0.5); display: none; align-items: center; justify-content: center; z-index: 1000; opacity: 0; visibility: hidden; transition: opacity 0.3s ease, visibility 0.3s ease;">
    <div class="popup-content" style="background: white; border-radius: 12px; padding: 0; max-width: 800px; width: 90%; max-height: 90vh; overflow-y: auto; transform: scale(0.9); transition: transform 0.3s ease; box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);">
        <div class="bg-white w-full h-auto shadow-lg overflow-y-auto">
            <!-- Header -->
            <div class="border-b border-neutral-200 p-6">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-3">
                        <div class="w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center">
                            <i class="fa-solid fa-sitemap text-purple-600 text-lg"></i>
                        </div>
                        <div>
                            <h1 class="text-2xl text-neutral-900">Add New VLAN</h1>
                            <p class="text-neutral-500 text-sm">Configure a new virtual LAN segment</p>
                        </div>
                    </div>
                    <button class="vlan-popup-close w-8 h-8 rounded-full bg-neutral-100 hover:bg-neutral-200 flex items-center justify-center">
                        <i class="fa-solid fa-xmark text-neutral-500"></i>
                    </button>
                </div>
            </div>
            <!-- Content -->
            <div class="p-6">
                <form id="vlan-form" class="space-y-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-neutral-700 mb-2">VLAN ID *</label>
                            <input type="number" id="vlan_id" name="vlan_id" min="1" max="4094" required
                                   class="w-full px-3 py-2 border border-neutral-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-purple-500">
                            <p class="text-xs text-neutral-500 mt-1">Valid range: 1-4094</p>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-neutral-700 mb-2">VLAN Name *</label>
                            <input type="text" id="vlan_name" name="vlan_name" required
                                   class="w-full px-3 py-2 border border-neutral-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-purple-500"
                                   placeholder="e.g., Guest Network">
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-neutral-700 mb-2">Description</label>
                        <textarea id="vlan_description" name="vlan_description" rows="3"
                                  class="w-full px-3 py-2 border border-neutral-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-purple-500"
                                  placeholder="Optional description for this VLAN"></textarea>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-neutral-700 mb-2">Priority</label>
                            <input type="number" id="vlan_priority" name="vlan_priority" min="0" max="7" value="0"
                                   class="w-full px-3 py-2 border border-neutral-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-purple-500">
                            <p class="text-xs text-neutral-500 mt-1">Priority level: 0-7</p>
                        </div>
                        <div class="flex items-center">
                            <input type="checkbox" id="vlan_enabled" name="vlan_enabled" checked
                                   class="w-4 h-4 text-purple-600 border-neutral-300 rounded focus:ring-purple-500">
                            <label for="vlan_enabled" class="ml-2 text-sm font-medium text-neutral-700">Enable VLAN</label>
                        </div>
                    </div>
                </form>
            </div>
            <!-- Footer -->
            <div class="border-t border-neutral-200 p-6 flex justify-end space-x-3">
                <button type="button" class="vlan-popup-cancel px-4 py-2 bg-neutral-100 text-neutral-700 rounded-lg hover:bg-neutral-200">
                    Cancel
                </button>
                <button type="button" class="vlan-popup-save px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700">
                    Create VLAN
                </button>
            </div>
        </div>
    </div>
</div>

<!-- NAT Rule Popup -->
<div id="nat-rule-popup" class="popup-overlay" style="position: fixed; inset: 0; background: rgba(0,0,0,0.5); display: none; align-items: center; justify-content: center; z-index: 1000; opacity: 0; visibility: hidden; transition: opacity 0.3s ease, visibility 0.3s ease;">
    <div class="popup-content" style="background: white; border-radius: 12px; padding: 0; max-width: 800px; width: 90%; max-height: 90vh; overflow-y: auto; transform: scale(0.9); transition: transform 0.3s ease; box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);">
        <div class="bg-white w-full h-auto shadow-lg overflow-y-auto">
            <!-- Header -->
            <div class="border-b border-neutral-200 p-6">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-3">
                        <div class="w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center">
                            <i class="fa-solid fa-exchange-alt text-green-600 text-lg"></i>
                        </div>
                        <div>
                            <h1 class="text-2xl text-neutral-900">Add New NAT Rule</h1>
                            <p class="text-neutral-500 text-sm">Configure network address translation rule</p>
                        </div>
                    </div>
                    <button class="nat-rule-popup-close w-8 h-8 rounded-full bg-neutral-100 hover:bg-neutral-200 flex items-center justify-center">
                        <i class="fa-solid fa-xmark text-neutral-500"></i>
                    </button>
                </div>
            </div>
            <!-- Content -->
            <div class="p-6">
                <form id="nat-rule-form" class="space-y-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-neutral-700 mb-2">Rule Name *</label>
                            <input type="text" id="nat_rule_name" name="nat_rule_name" required
                                   class="w-full px-3 py-2 border border-neutral-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500"
                                   placeholder="e.g., Office LAN NAT">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-neutral-700 mb-2">NAT Type *</label>
                            <select id="nat_type" name="nat_type" required
                                    class="w-full px-3 py-2 border border-neutral-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500">
                                <option value="source">Source NAT (SNAT)</option>
                                <option value="destination">Destination NAT (DNAT)</option>
                                <option value="masquerade">Masquerade</option>
                            </select>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-neutral-700 mb-2">Source Network</label>
                            <input type="text" id="nat_source" name="nat_source"
                                   class="w-full px-3 py-2 border border-neutral-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500"
                                   placeholder="e.g., 192.168.1.0/24">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-neutral-700 mb-2">Destination Network</label>
                            <input type="text" id="nat_destination" name="nat_destination"
                                   class="w-full px-3 py-2 border border-neutral-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500"
                                   placeholder="e.g., 10.0.0.0/24">
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-neutral-700 mb-2">Action *</label>
                        <select id="nat_action" name="nat_action" required
                                class="w-full px-3 py-2 border border-neutral-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500">
                            <option value="accept">Accept</option>
                            <option value="drop">Drop</option>
                            <option value="reject">Reject</option>
                        </select>
                    </div>
                </form>
            </div>
            <!-- Footer -->
            <div class="border-t border-neutral-200 p-6 flex justify-end space-x-3">
                <button type="button" class="nat-rule-popup-cancel px-4 py-2 bg-neutral-100 text-neutral-700 rounded-lg hover:bg-neutral-200">
                    Cancel
                </button>
                <button type="button" class="nat-rule-popup-save px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700">
                    Create NAT Rule
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Firewall Rule Popup -->
<div id="firewall-rule-popup" class="popup-overlay" style="position: fixed; inset: 0; background: rgba(0,0,0,0.5); display: none; align-items: center; justify-content: center; z-index: 1000; opacity: 0; visibility: hidden; transition: opacity 0.3s ease, visibility 0.3s ease;">
    <div class="popup-content" style="background: white; border-radius: 12px; padding: 0; max-width: 800px; width: 90%; max-height: 90vh; overflow-y: auto; transform: scale(0.9); transition: transform 0.3s ease; box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);">
        <div class="bg-white w-full h-auto shadow-lg overflow-y-auto">
            <!-- Header -->
            <div class="border-b border-neutral-200 p-6">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-3">
                        <div class="w-10 h-10 bg-red-100 rounded-lg flex items-center justify-center">
                            <i class="fa-solid fa-shield-alt text-red-600 text-lg"></i>
                        </div>
                        <div>
                            <h1 class="text-2xl text-neutral-900">Add New Firewall Rule</h1>
                            <p class="text-neutral-500 text-sm">Configure firewall security rule</p>
                        </div>
                    </div>
                    <button class="firewall-rule-popup-close w-8 h-8 rounded-full bg-neutral-100 hover:bg-neutral-200 flex items-center justify-center">
                        <i class="fa-solid fa-xmark text-neutral-500"></i>
                    </button>
                </div>
            </div>
            <!-- Content -->
            <div class="p-6">
                <form id="firewall-rule-form" class="space-y-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-neutral-700 mb-2">Rule Name *</label>
                            <input type="text" id="firewall_rule_name" name="firewall_rule_name" required
                                   class="w-full px-3 py-2 border border-neutral-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-red-500"
                                   placeholder="e.g., Block External Access">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-neutral-700 mb-2">Action *</label>
                            <select id="firewall_action" name="firewall_action" required
                                    class="w-full px-3 py-2 border border-neutral-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-red-500">
                                <option value="accept">Accept</option>
                                <option value="drop">Drop</option>
                                <option value="reject">Reject</option>
                            </select>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-neutral-700 mb-2">Protocol</label>
                            <select id="firewall_protocol" name="firewall_protocol"
                                    class="w-full px-3 py-2 border border-neutral-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-red-500">
                                <option value="tcp">TCP</option>
                                <option value="udp">UDP</option>
                                <option value="icmp">ICMP</option>
                                <option value="any">Any</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-neutral-700 mb-2">Source Port</label>
                            <input type="text" id="firewall_source_port" name="firewall_source_port"
                                   class="w-full px-3 py-2 border border-neutral-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-red-500"
                                   placeholder="e.g., 80,443 or any">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-neutral-700 mb-2">Destination Port</label>
                            <input type="text" id="firewall_dest_port" name="firewall_dest_port"
                                   class="w-full px-3 py-2 border border-neutral-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-red-500"
                                   placeholder="e.g., 22,8080 or any">
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-neutral-700 mb-2">Source Address</label>
                            <input type="text" id="firewall_source" name="firewall_source"
                                   class="w-full px-3 py-2 border border-neutral-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-red-500"
                                   placeholder="e.g., 192.168.1.0/24">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-neutral-700 mb-2">Destination Address</label>
                            <input type="text" id="firewall_destination" name="firewall_destination"
                                   class="w-full px-3 py-2 border border-neutral-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-red-500"
                                   placeholder="e.g., 10.0.0.0/24">
                        </div>
                    </div>
                </form>
            </div>
            <!-- Footer -->
            <div class="border-t border-neutral-200 p-6 flex justify-end space-x-3">
                <button type="button" class="firewall-rule-popup-cancel px-4 py-2 bg-neutral-100 text-neutral-700 rounded-lg hover:bg-neutral-200">
                    Cancel
                </button>
                <button type="button" class="firewall-rule-popup-save px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700">
                    Create Firewall Rule
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Static Route Popup -->
<div id="static-route-popup" class="popup-overlay" style="position: fixed; inset: 0; background: rgba(0,0,0,0.5); display: none; align-items: center; justify-content: center; z-index: 1000; opacity: 0; visibility: hidden; transition: opacity 0.3s ease, visibility 0.3s ease;">
    <div class="popup-content" style="background: white; border-radius: 12px; padding: 0; max-width: 800px; width: 90%; max-height: 90vh; overflow-y: auto; transform: scale(0.9); transition: transform 0.3s ease; box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);">
        <div class="bg-white w-full h-auto shadow-lg overflow-y-auto">
            <!-- Header -->
            <div class="border-b border-neutral-200 p-6">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-3">
                        <div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center">
                            <i class="fa-solid fa-route text-blue-600 text-lg"></i>
                        </div>
                        <div>
                            <h1 class="text-2xl text-neutral-900">Add New Static Route</h1>
                            <p class="text-neutral-500 text-sm">Configure manual network routing</p>
                        </div>
                    </div>
                    <button class="static-route-popup-close w-8 h-8 rounded-full bg-neutral-100 hover:bg-neutral-200 flex items-center justify-center">
                        <i class="fa-solid fa-xmark text-neutral-500"></i>
                    </button>
                </div>
            </div>
            <!-- Content -->
            <div class="p-6">
                <form id="static-route-form" class="space-y-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-neutral-700 mb-2">Destination Network *</label>
                            <input type="text" id="route_destination" name="route_destination" required
                                   class="w-full px-3 py-2 border border-neutral-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                   placeholder="e.g., 192.168.2.0/24">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-neutral-700 mb-2">Gateway *</label>
                            <input type="text" id="route_gateway" name="route_gateway" required
                                   class="w-full px-3 py-2 border border-neutral-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                   placeholder="e.g., 192.168.1.1">
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-neutral-700 mb-2">Interface</label>
                            <select id="route_interface" name="route_interface"
                                    class="w-full px-3 py-2 border border-neutral-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                <option value="eth0">eth0</option>
                                <option value="eth1">eth1</option>
                                <option value="wlan0">wlan0</option>
                                <option value="wlan1">wlan1</option>
                                <option value="any">Any</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-neutral-700 mb-2">Metric</label>
                            <input type="number" id="route_metric" name="route_metric" min="1" max="9999" value="100"
                                   class="w-full px-3 py-2 border border-neutral-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        </div>
                    </div>
                </form>
            </div>
            <!-- Footer -->
            <div class="border-t border-neutral-200 p-6 flex justify-end space-x-3">
                <button type="button" class="static-route-popup-cancel px-4 py-2 bg-neutral-100 text-neutral-700 rounded-lg hover:bg-neutral-200">
                    Cancel
                </button>
                <button type="button" class="static-route-popup-save px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                    Create Static Route
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Bridge Popup -->
<div id="bridge-popup" class="popup-overlay" style="position: fixed; inset: 0; background: rgba(0,0,0,0.5); display: none; align-items: center; justify-content: center; z-index: 1000; opacity: 0; visibility: hidden; transition: opacity 0.3s ease, visibility 0.3s ease;">
    <div class="popup-content" style="background: white; border-radius: 12px; padding: 0; max-width: 800px; width: 90%; max-height: 90vh; overflow-y: auto; transform: scale(0.9); transition: transform 0.3s ease; box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);">
        <div class="bg-white w-full h-auto shadow-lg overflow-y-auto">
            <!-- Header -->
            <div class="border-b border-neutral-200 p-6">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-3">
                        <div class="w-10 h-10 bg-orange-100 rounded-lg flex items-center justify-center">
                            <i class="fa-solid fa-bridge text-orange-600 text-lg"></i>
                        </div>
                        <div>
                            <h1 class="text-2xl text-neutral-900">Add New Network Bridge</h1>
                            <p class="text-neutral-500 text-sm">Configure network bridge interface</p>
                        </div>
                    </div>
                    <button class="bridge-popup-close w-8 h-8 rounded-full bg-neutral-100 hover:bg-neutral-200 flex items-center justify-center">
                        <i class="fa-solid fa-xmark text-neutral-500"></i>
                    </button>
                </div>
            </div>
            <!-- Content -->
            <div class="p-6">
                <form id="bridge-form" class="space-y-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-neutral-700 mb-2">Bridge Name *</label>
                            <input type="text" id="bridge_name" name="bridge_name" required
                                   class="w-full px-3 py-2 border border-neutral-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-orange-500"
                                   placeholder="e.g., br0">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-neutral-700 mb-2">IP Address</label>
                            <input type="text" id="bridge_ip" name="bridge_ip"
                                   class="w-full px-3 py-2 border border-neutral-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-orange-500"
                                   placeholder="e.g., 192.168.1.1/24">
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-neutral-700 mb-2">Member Interfaces</label>
                        <div class="grid grid-cols-2 md:grid-cols-3 gap-3 p-4 border border-neutral-200 rounded-lg">
                            <label class="flex items-center">
                                <input type="checkbox" name="interface_eth0" value="eth0" class="w-4 h-4 text-orange-600 border-neutral-300 rounded focus:ring-orange-500">
                                <span class="ml-2 text-sm">eth0</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" name="interface_eth1" value="eth1" class="w-4 h-4 text-orange-600 border-neutral-300 rounded focus:ring-orange-500">
                                <span class="ml-2 text-sm">eth1</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" name="interface_eth2" value="eth2" class="w-4 h-4 text-orange-600 border-neutral-300 rounded focus:ring-orange-500">
                                <span class="ml-2 text-sm">eth2</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" name="interface_wlan0" value="wlan0" class="w-4 h-4 text-orange-600 border-neutral-300 rounded focus:ring-orange-500">
                                <span class="ml-2 text-sm">wlan0</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" name="interface_wlan1" value="wlan1" class="w-4 h-4 text-orange-600 border-neutral-300 rounded focus:ring-orange-500">
                                <span class="ml-2 text-sm">wlan1</span>
                            </label>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-neutral-700 mb-2">STP Priority</label>
                            <input type="number" id="bridge_priority" name="bridge_priority" min="0" max="65535" value="32768"
                                   class="w-full px-3 py-2 border border-neutral-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-orange-500">
                        </div>
                        <div class="flex items-center">
                            <input type="checkbox" id="bridge_stp" name="bridge_stp" class="w-4 h-4 text-orange-600 border-neutral-300 rounded focus:ring-orange-500">
                            <label for="bridge_stp" class="ml-2 text-sm font-medium text-neutral-700">Enable STP</label>
                        </div>
                    </div>
                </form>
            </div>
            <!-- Footer -->
            <div class="border-t border-neutral-200 p-6 flex justify-end space-x-3">
                <button type="button" class="bridge-popup-cancel px-4 py-2 bg-neutral-100 text-neutral-700 rounded-lg hover:bg-neutral-200">
                    Cancel
                </button>
                <button type="button" class="bridge-popup-save px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700">
                    Create Bridge
                </button>
            </div>
        </div>
    </div>
</div>

<script>
/**
 * Advanced Network Section Manager
 * Manages all network configuration functionality
 */
class AdvancedNetworkSection {
    constructor() {
        this.state = {
            vlans: [],
            natRules: [],
            firewallRules: [],
            staticRoutes: [],
            bridges: []
        };
        this.init();
    }

    init() {
        console.log('[ADVANCED-NETWORK] Initializing Advanced Network Section...');
        
        // Add debugging to check if elements exist
        console.log('[ADVANCED-NETWORK] Checking if buttons exist...');
        console.log('[ADVANCED-NETWORK] add-vlan-btn:', document.getElementById('add-vlan-btn'));
        console.log('[ADVANCED-NETWORK] add-nat-rule-btn:', document.getElementById('add-nat-rule-btn'));
        console.log('[ADVANCED-NETWORK] add-firewall-rule-btn:', document.getElementById('add-firewall-rule-btn'));
        console.log('[ADVANCED-NETWORK] add-static-route-btn:', document.getElementById('add-static-route-btn'));
        console.log('[ADVANCED-NETWORK] add-bridge-btn:', document.getElementById('add-bridge-btn'));
        
        // Track popup state
        this.popupOpen = false;
        this.currentPopup = null;
        
        this.setupEventHandlers();
        this.setupGlobalHandlers();
        this.loadInitialData();
    }

    setupGlobalHandlers() {
        console.log('[ADVANCED-NETWORK] Setting up global handlers...');
        
        // Prevent any global click handlers from interfering when popup is open
        document.addEventListener('click', (e) => {
            if (this.popupOpen) {
                // Check if click is inside current popup
                const popup = document.getElementById(this.currentPopup);
                if (popup && !popup.contains(e.target)) {
                    // Click outside popup - don't let other handlers process it
                    e.stopImmediatePropagation();
                    e.preventDefault();
                    e.stopPropagation();
                    console.log('[ADVANCED-NETWORK] Prevented outside click interference');
                    return false;
                }
            }
        }, true);
        
        // Prevent form submissions anywhere when popup is open
        document.addEventListener('submit', (e) => {
            if (this.popupOpen) {
                const popup = document.getElementById(this.currentPopup);
                if (popup && !popup.contains(e.target)) {
                    e.stopImmediatePropagation();
                    e.preventDefault();
                    e.stopPropagation();
                    console.log('[ADVANCED-NETWORK] Prevented outside form submission interference');
                    return false;
                }
            }
        }, true);
        
        console.log('[ADVANCED-NETWORK] Global handlers setup completed');
    }

    setupEventHandlers() {
        console.log('[ADVANCED-NETWORK] Setting up event handlers...');
        
        try {
            // Use capture phase and aggressive event prevention
            // VLAN popup handlers
            const vlanBtn = document.getElementById('add-vlan-btn');
            if (vlanBtn) {
                console.log('[ADVANCED-NETWORK] Adding VLAN button event listener');
                vlanBtn.addEventListener('click', (e) => {
                    console.log('[ADVANCED-NETWORK] VLAN button clicked!', e);
                    e.stopImmediatePropagation(); // Stop all other listeners
                    e.preventDefault();
                    e.stopPropagation();
                    this.showVlanPopup();
                    return false; // Extra prevention
                }, true); // Use capture phase
            } else {
                console.error('[ADVANCED-NETWORK] VLAN button not found!');
            }
            
            const vlanClose = document.querySelector('.vlan-popup-close');
            if (vlanClose) {
                vlanClose.addEventListener('click', (e) => {
                    e.stopImmediatePropagation();
                    e.preventDefault();
                    e.stopPropagation();
                    this.hideVlanPopup();
                    return false;
                }, true);
            }
            const vlanCancel = document.querySelector('.vlan-popup-cancel');
            if (vlanCancel) {
                vlanCancel.addEventListener('click', (e) => {
                    e.stopImmediatePropagation();
                    e.preventDefault();
                    e.stopPropagation();
                    this.hideVlanPopup();
                    return false;
                }, true);
            }
            const vlanSave = document.querySelector('.vlan-popup-save');
            if (vlanSave) {
                vlanSave.addEventListener('click', (e) => {
                    e.stopImmediatePropagation();
                    e.preventDefault();
                    e.stopPropagation();
                    this.saveVlan();
                    return false;
                }, true);
            }

            // Prevent VLAN form submission
            const vlanForm = document.getElementById('vlan-form');
            if (vlanForm) {
                vlanForm.addEventListener('submit', (e) => {
                    e.stopImmediatePropagation();
                    e.preventDefault();
                    e.stopPropagation();
                    this.saveVlan();
                    return false;
                }, true);
            }

            // NAT rule popup handlers
            const natBtn = document.getElementById('add-nat-rule-btn');
            if (natBtn) {
                console.log('[ADVANCED-NETWORK] Adding NAT rule button event listener');
                natBtn.addEventListener('click', (e) => {
                    console.log('[ADVANCED-NETWORK] NAT rule button clicked!', e);
                    e.stopImmediatePropagation();
                    e.preventDefault();
                    e.stopPropagation();
                    this.showNatRulePopup();
                    return false;
                }, true);
            } else {
                console.error('[ADVANCED-NETWORK] NAT rule button not found!');
            }
            
            const natClose = document.querySelector('.nat-rule-popup-close');
            if (natClose) {
                natClose.addEventListener('click', (e) => {
                    e.stopImmediatePropagation();
                    e.preventDefault();
                    e.stopPropagation();
                    this.hideNatRulePopup();
                    return false;
                }, true);
            }
            const natCancel = document.querySelector('.nat-rule-popup-cancel');
            if (natCancel) {
                natCancel.addEventListener('click', (e) => {
                    e.stopImmediatePropagation();
                    e.preventDefault();
                    e.stopPropagation();
                    this.hideNatRulePopup();
                    return false;
                }, true);
            }
            const natSave = document.querySelector('.nat-rule-popup-save');
            if (natSave) {
                natSave.addEventListener('click', (e) => {
                    e.stopImmediatePropagation();
                    e.preventDefault();
                    e.stopPropagation();
                    this.saveNatRule();
                    return false;
                }, true);
            }

            // Prevent NAT form submission
            const natForm = document.getElementById('nat-rule-form');
            if (natForm) {
                natForm.addEventListener('submit', (e) => {
                    e.stopImmediatePropagation();
                    e.preventDefault();
                    e.stopPropagation();
                    this.saveNatRule();
                    return false;
                }, true);
            }

            // Firewall rule popup handlers
            const firewallBtn = document.getElementById('add-firewall-rule-btn');
            if (firewallBtn) {
                console.log('[ADVANCED-NETWORK] Adding Firewall rule button event listener');
                firewallBtn.addEventListener('click', (e) => {
                    console.log('[ADVANCED-NETWORK] Firewall rule button clicked!', e);
                    e.stopImmediatePropagation();
                    e.preventDefault();
                    e.stopPropagation();
                    this.showFirewallRulePopup();
                    return false;
                }, true);
            } else {
                console.error('[ADVANCED-NETWORK] Firewall rule button not found!');
            }
            
            const firewallClose = document.querySelector('.firewall-rule-popup-close');
            if (firewallClose) {
                firewallClose.addEventListener('click', (e) => {
                    e.stopImmediatePropagation();
                    e.preventDefault();
                    e.stopPropagation();
                    this.hideFirewallRulePopup();
                    return false;
                }, true);
            }
            const firewallCancel = document.querySelector('.firewall-rule-popup-cancel');
            if (firewallCancel) {
                firewallCancel.addEventListener('click', (e) => {
                    e.stopImmediatePropagation();
                    e.preventDefault();
                    e.stopPropagation();
                    this.hideFirewallRulePopup();
                    return false;
                }, true);
            }
            const firewallSave = document.querySelector('.firewall-rule-popup-save');
            if (firewallSave) {
                firewallSave.addEventListener('click', (e) => {
                    e.stopImmediatePropagation();
                    e.preventDefault();
                    e.stopPropagation();
                    this.saveFirewallRule();
                    return false;
                }, true);
            }

            // Prevent Firewall form submission
            const firewallForm = document.getElementById('firewall-rule-form');
            if (firewallForm) {
                firewallForm.addEventListener('submit', (e) => {
                    e.stopImmediatePropagation();
                    e.preventDefault();
                    e.stopPropagation();
                    this.saveFirewallRule();
                    return false;
                }, true);
            }

            // Static route popup handlers
            const routeBtn = document.getElementById('add-static-route-btn');
            if (routeBtn) {
                console.log('[ADVANCED-NETWORK] Adding Static route button event listener');
                routeBtn.addEventListener('click', (e) => {
                    console.log('[ADVANCED-NETWORK] Static route button clicked!', e);
                    e.stopImmediatePropagation();
                    e.preventDefault();
                    e.stopPropagation();
                    this.showStaticRoutePopup();
                    return false;
                }, true);
            } else {
                console.error('[ADVANCED-NETWORK] Static route button not found!');
            }
            
            const routeClose = document.querySelector('.static-route-popup-close');
            if (routeClose) {
                routeClose.addEventListener('click', (e) => {
                    e.stopImmediatePropagation();
                    e.preventDefault();
                    e.stopPropagation();
                    this.hideStaticRoutePopup();
                    return false;
                }, true);
            }
            const routeCancel = document.querySelector('.static-route-popup-cancel');
            if (routeCancel) {
                routeCancel.addEventListener('click', (e) => {
                    e.stopImmediatePropagation();
                    e.preventDefault();
                    e.stopPropagation();
                    this.hideStaticRoutePopup();
                    return false;
                }, true);
            }
            const routeSave = document.querySelector('.static-route-popup-save');
            if (routeSave) {
                routeSave.addEventListener('click', (e) => {
                    e.stopImmediatePropagation();
                    e.preventDefault();
                    e.stopPropagation();
                    this.saveStaticRoute();
                    return false;
                }, true);
            }

            // Prevent Static route form submission
            const routeForm = document.getElementById('static-route-form');
            if (routeForm) {
                routeForm.addEventListener('submit', (e) => {
                    e.stopImmediatePropagation();
                    e.preventDefault();
                    e.stopPropagation();
                    this.saveStaticRoute();
                    return false;
                }, true);
            }

            // Bridge popup handlers
            const bridgeBtn = document.getElementById('add-bridge-btn');
            if (bridgeBtn) {
                console.log('[ADVANCED-NETWORK] Adding Bridge button event listener');
                bridgeBtn.addEventListener('click', (e) => {
                    console.log('[ADVANCED-NETWORK] Bridge button clicked!', e);
                    e.stopImmediatePropagation();
                    e.preventDefault();
                    e.stopPropagation();
                    this.showBridgePopup();
                    return false;
                }, true);
            } else {
                console.error('[ADVANCED-NETWORK] Bridge button not found!');
            }
            
            const bridgeClose = document.querySelector('.bridge-popup-close');
            if (bridgeClose) {
                bridgeClose.addEventListener('click', (e) => {
                    e.stopImmediatePropagation();
                    e.preventDefault();
                    e.stopPropagation();
                    this.hideBridgePopup();
                    return false;
                }, true);
            }
            const bridgeCancel = document.querySelector('.bridge-popup-cancel');
            if (bridgeCancel) {
                bridgeCancel.addEventListener('click', (e) => {
                    e.stopImmediatePropagation();
                    e.preventDefault();
                    e.stopPropagation();
                    this.hideBridgePopup();
                    return false;
                }, true);
            }
            const bridgeSave = document.querySelector('.bridge-popup-save');
            if (bridgeSave) {
                bridgeSave.addEventListener('click', (e) => {
                    e.stopImmediatePropagation();
                    e.preventDefault();
                    e.stopPropagation();
                    this.saveBridge();
                    return false;
                }, true);
            }

            // Prevent Bridge form submission
            const bridgeForm = document.getElementById('bridge-form');
            if (bridgeForm) {
                bridgeForm.addEventListener('submit', (e) => {
                    e.stopImmediatePropagation();
                    e.preventDefault();
                    e.stopPropagation();
                    this.saveBridge();
                    return false;
                }, true);
            }

            // Close on backdrop click with capture phase
            document.querySelectorAll('.popup-overlay').forEach(popup => {
                popup.addEventListener('click', (e) => {
                    if (e.target === popup) {
                        e.stopImmediatePropagation();
                        e.preventDefault();
                        e.stopPropagation();
                        this.hideAllPopups();
                        return false;
                    }
                }, true);
            });

            // Close on escape key with capture phase
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    e.stopImmediatePropagation();
                    e.preventDefault();
                    this.hideAllPopups();
                    return false;
                }
            }, true);
            
            console.log('[ADVANCED-NETWORK] Event handlers setup completed');
        } catch (error) {
            console.error('[ADVANCED-NETWORK] Error setting up event handlers:', error);
        }
    }

    // Popup show/hide methods following VPN section pattern
    showVlanPopup() {
        console.log('[ADVANCED-NETWORK] Showing VLAN popup');
        const popup = document.getElementById('vlan-popup');
        if (popup) {
            // Set state before showing
            this.popupOpen = true;
            this.currentPopup = 'vlan-popup';
            
            console.log('[ADVANCED-NETWORK] VLAN popup element found, current styles:', {
                display: popup.style.display,
                opacity: popup.style.opacity,
                visibility: popup.style.visibility
            });
            
            popup.style.display = 'flex';
            // Force reflow for animation
            popup.offsetHeight;
            popup.style.opacity = '1';
            popup.style.visibility = 'visible';

            const content = popup.querySelector('.popup-content');
            if (content) {
                content.style.transform = 'scale(1)';
            }

            // Prevent body scroll
            document.body.style.overflow = 'hidden';
            
            console.log('[ADVANCED-NETWORK] VLAN popup shown successfully');
        } else {
            console.error('[ADVANCED-NETWORK] VLAN popup element not found!');
        }
    }

    hideVlanPopup() {
        console.log('[ADVANCED-NETWORK] Hiding VLAN popup');
        const popup = document.getElementById('vlan-popup');
        if (popup) {
            // Clear state immediately
            this.popupOpen = false;
            this.currentPopup = null;
            
            popup.style.opacity = '0';
            popup.style.visibility = 'hidden';

            const content = popup.querySelector('.popup-content');
            if (content) {
                content.style.transform = 'scale(0.9)';
            }

            setTimeout(() => {
                popup.style.display = 'none';
                document.body.style.overflow = '';
                console.log('[ADVANCED-NETWORK] VLAN popup hidden and cleanup completed');
            }, 300);
        } else {
            console.error('[ADVANCED-NETWORK] VLAN popup element not found for hiding!');
        }
    }

    showNatRulePopup() {
        console.log('[ADVANCED-NETWORK] Showing NAT rule popup');
        const popup = document.getElementById('nat-rule-popup');
        if (popup) {
            this.popupOpen = true;
            this.currentPopup = 'nat-rule-popup';
            
            popup.style.display = 'flex';
            popup.offsetHeight;
            popup.style.opacity = '1';
            popup.style.visibility = 'visible';

            const content = popup.querySelector('.popup-content');
            if (content) {
                content.style.transform = 'scale(1)';
            }

            document.body.style.overflow = 'hidden';
            console.log('[ADVANCED-NETWORK] NAT rule popup shown successfully');
        } else {
            console.error('[ADVANCED-NETWORK] NAT rule popup element not found!');
        }
    }

    hideNatRulePopup() {
        console.log('[ADVANCED-NETWORK] Hiding NAT rule popup');
        const popup = document.getElementById('nat-rule-popup');
        if (popup) {
            this.popupOpen = false;
            this.currentPopup = null;
            
            popup.style.opacity = '0';
            popup.style.visibility = 'hidden';

            const content = popup.querySelector('.popup-content');
            if (content) {
                content.style.transform = 'scale(0.9)';
            }

            setTimeout(() => {
                popup.style.display = 'none';
                document.body.style.overflow = '';
                console.log('[ADVANCED-NETWORK] NAT rule popup hidden and cleanup completed');
            }, 300);
        } else {
            console.error('[ADVANCED-NETWORK] NAT rule popup element not found for hiding!');
        }
    }

    showFirewallRulePopup() {
        console.log('[ADVANCED-NETWORK] Showing firewall rule popup');
        const popup = document.getElementById('firewall-rule-popup');
        if (popup) {
            this.popupOpen = true;
            this.currentPopup = 'firewall-rule-popup';
            
            popup.style.display = 'flex';
            popup.offsetHeight;
            popup.style.opacity = '1';
            popup.style.visibility = 'visible';

            const content = popup.querySelector('.popup-content');
            if (content) {
                content.style.transform = 'scale(1)';
            }

            document.body.style.overflow = 'hidden';
            console.log('[ADVANCED-NETWORK] Firewall rule popup shown successfully');
        } else {
            console.error('[ADVANCED-NETWORK] Firewall rule popup element not found!');
        }
    }

    hideFirewallRulePopup() {
        console.log('[ADVANCED-NETWORK] Hiding firewall rule popup');
        const popup = document.getElementById('firewall-rule-popup');
        if (popup) {
            this.popupOpen = false;
            this.currentPopup = null;
            
            popup.style.opacity = '0';
            popup.style.visibility = 'hidden';

            const content = popup.querySelector('.popup-content');
            if (content) {
                content.style.transform = 'scale(0.9)';
            }

            setTimeout(() => {
                popup.style.display = 'none';
                document.body.style.overflow = '';
                console.log('[ADVANCED-NETWORK] Firewall rule popup hidden and cleanup completed');
            }, 300);
        } else {
            console.error('[ADVANCED-NETWORK] Firewall rule popup element not found for hiding!');
        }
    }

    showStaticRoutePopup() {
        console.log('[ADVANCED-NETWORK] Showing static route popup');
        const popup = document.getElementById('static-route-popup');
        if (popup) {
            this.popupOpen = true;
            this.currentPopup = 'static-route-popup';
            
            popup.style.display = 'flex';
            popup.offsetHeight;
            popup.style.opacity = '1';
            popup.style.visibility = 'visible';

            const content = popup.querySelector('.popup-content');
            if (content) {
                content.style.transform = 'scale(1)';
            }

            document.body.style.overflow = 'hidden';
            console.log('[ADVANCED-NETWORK] Static route popup shown successfully');
        } else {
            console.error('[ADVANCED-NETWORK] Static route popup element not found!');
        }
    }

    hideStaticRoutePopup() {
        console.log('[ADVANCED-NETWORK] Hiding static route popup');
        const popup = document.getElementById('static-route-popup');
        if (popup) {
            this.popupOpen = false;
            this.currentPopup = null;
            
            popup.style.opacity = '0';
            popup.style.visibility = 'hidden';

            const content = popup.querySelector('.popup-content');
            if (content) {
                content.style.transform = 'scale(0.9)';
            }

            setTimeout(() => {
                popup.style.display = 'none';
                document.body.style.overflow = '';
                console.log('[ADVANCED-NETWORK] Static route popup hidden and cleanup completed');
            }, 300);
        } else {
            console.error('[ADVANCED-NETWORK] Static route popup element not found for hiding!');
        }
    }

    showBridgePopup() {
        console.log('[ADVANCED-NETWORK] Showing bridge popup');
        const popup = document.getElementById('bridge-popup');
        if (popup) {
            this.popupOpen = true;
            this.currentPopup = 'bridge-popup';
            
            popup.style.display = 'flex';
            popup.offsetHeight;
            popup.style.opacity = '1';
            popup.style.visibility = 'visible';

            const content = popup.querySelector('.popup-content');
            if (content) {
                content.style.transform = 'scale(1)';
            }

            document.body.style.overflow = 'hidden';
            console.log('[ADVANCED-NETWORK] Bridge popup shown successfully');
        } else {
            console.error('[ADVANCED-NETWORK] Bridge popup element not found!');
        }
    }

    hideBridgePopup() {
        console.log('[ADVANCED-NETWORK] Hiding bridge popup');
        const popup = document.getElementById('bridge-popup');
        if (popup) {
            this.popupOpen = false;
            this.currentPopup = null;
            
            popup.style.opacity = '0';
            popup.style.visibility = 'hidden';

            const content = popup.querySelector('.popup-content');
            if (content) {
                content.style.transform = 'scale(0.9)';
            }

            setTimeout(() => {
                popup.style.display = 'none';
                document.body.style.overflow = '';
                console.log('[ADVANCED-NETWORK] Bridge popup hidden and cleanup completed');
            }, 300);
        } else {
            console.error('[ADVANCED-NETWORK] Bridge popup element not found for hiding!');
        }
    }

    hideAllPopups() {
        console.log('[ADVANCED-NETWORK] Hiding all popups');
        this.popupOpen = false;
        this.currentPopup = null;
        this.hideVlanPopup();
        this.hideNatRulePopup();
        this.hideFirewallRulePopup();
        this.hideStaticRoutePopup();
        this.hideBridgePopup();
    }

    // Form submission methods
    saveVlan() {
        const form = document.getElementById('vlan-form');
        if (form.checkValidity()) {
            const formData = new FormData(form);
            const vlanData = Object.fromEntries(formData);
            
            console.log('[ADVANCED-NETWORK] Saving VLAN:', vlanData);
            this.showNotification('VLAN created successfully', 'success');
            this.hideVlanPopup();
            form.reset();
            
            // Add to state and update table
            this.state.vlans.push({
                id: Date.now(),
                vlan_id: vlanData.vlan_id,
                name: vlanData.vlan_name,
                description: vlanData.vlan_description,
                priority: vlanData.vlan_priority,
                enabled: vlanData.vlan_enabled
            });
            this.updateVlanTable();
        } else {
            form.reportValidity();
        }
    }

    saveNatRule() {
        const form = document.getElementById('nat-rule-form');
        if (form.checkValidity()) {
            const formData = new FormData(form);
            const natData = Object.fromEntries(formData);
            
            console.log('[ADVANCED-NETWORK] Saving NAT rule:', natData);
            this.showNotification('NAT rule created successfully', 'success');
            this.hideNatRulePopup();
            form.reset();
            
            // Add to state and update table
            this.state.natRules.push({
                id: Date.now(),
                name: natData.nat_rule_name,
                type: natData.nat_type,
                source: natData.nat_source,
                destination: natData.nat_destination,
                action: natData.nat_action
            });
            this.updateNatRuleTable();
        } else {
            form.reportValidity();
        }
    }

    saveFirewallRule() {
        const form = document.getElementById('firewall-rule-form');
        if (form.checkValidity()) {
            const formData = new FormData(form);
            const firewallData = Object.fromEntries(formData);
            
            console.log('[ADVANCED-NETWORK] Saving firewall rule:', firewallData);
            this.showNotification('Firewall rule created successfully', 'success');
            this.hideFirewallRulePopup();
            form.reset();
            
            // Add to state and update table
            this.state.firewallRules.push({
                id: Date.now(),
                name: firewallData.firewall_rule_name,
                action: firewallData.firewall_action,
                protocol: firewallData.firewall_protocol,
                source: firewallData.firewall_source,
                destination: firewallData.firewall_destination,
                source_port: firewallData.firewall_source_port,
                dest_port: firewallData.firewall_dest_port
            });
            this.updateFirewallRuleTable();
        } else {
            form.reportValidity();
        }
    }

    saveStaticRoute() {
        const form = document.getElementById('static-route-form');
        if (form.checkValidity()) {
            const formData = new FormData(form);
            const routeData = Object.fromEntries(formData);
            
            console.log('[ADVANCED-NETWORK] Saving static route:', routeData);
            this.showNotification('Static route created successfully', 'success');
            this.hideStaticRoutePopup();
            form.reset();
            
            // Add to state and update table
            this.state.staticRoutes.push({
                id: Date.now(),
                destination: routeData.route_destination,
                gateway: routeData.route_gateway,
                interface: routeData.route_interface,
                metric: routeData.route_metric
            });
            this.updateStaticRouteTable();
        } else {
            form.reportValidity();
        }
    }

    saveBridge() {
        const form = document.getElementById('bridge-form');
        if (form.checkValidity()) {
            const formData = new FormData(form);
            const bridgeData = Object.fromEntries(formData);
            
            // Get selected interfaces
            const interfaces = [];
            form.querySelectorAll('input[type="checkbox"]:checked').forEach(checkbox => {
                interfaces.push(checkbox.value);
            });
            
            console.log('[ADVANCED-NETWORK] Saving bridge:', { ...bridgeData, interfaces });
            this.showNotification('Bridge created successfully', 'success');
            this.hideBridgePopup();
            form.reset();
            
            // Add to state and update table
            this.state.bridges.push({
                id: Date.now(),
                name: bridgeData.bridge_name,
                ip_address: bridgeData.bridge_ip,
                interfaces: interfaces.join(', '),
                stp_enabled: bridgeData.bridge_stp,
                priority: bridgeData.bridge_priority,
                status: 'Active'
            });
            this.updateBridgeTable();
        } else {
            form.reportValidity();
        }
    }

    // Table update methods
    updateVlanTable() {
        const tbody = document.getElementById('vlan-table-body');
        const count = document.getElementById('vlan-count');
        
        tbody.innerHTML = '';
        count.textContent = `${this.state.vlans.length} VLANs`;
        
        this.state.vlans.forEach(vlan => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td class="px-6 py-4 whitespace-nowrap text-sm text-neutral-900">${vlan.vlan_id}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-neutral-900">${vlan.name}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-neutral-500">${vlan.description || '-'}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-neutral-900">${vlan.priority}</td>
                <td class="px-6 py-4 whitespace-nowrap">
                    <span class="px-2 py-1 text-xs rounded-full ${vlan.enabled ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">
                        ${vlan.enabled ? 'Enabled' : 'Disabled'}
                    </span>
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-neutral-500">
                    <button class="text-blue-600 hover:text-blue-900 mr-3">Edit</button>
                    <button class="text-red-600 hover:text-red-900">Delete</button>
                </td>
            `;
            tbody.appendChild(row);
        });
    }

    updateNatRuleTable() {
        const tbody = document.getElementById('nat-rules-table-body');
        const count = document.getElementById('nat-rules-count');
        
        tbody.innerHTML = '';
        count.textContent = `${this.state.natRules.length} rules`;
        
        this.state.natRules.forEach(rule => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td class="px-6 py-4 whitespace-nowrap text-sm text-neutral-900">${rule.name}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-neutral-900">${rule.type}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-neutral-500">${rule.source || '-'}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-neutral-500">${rule.destination || '-'}</td>
                <td class="px-6 py-4 whitespace-nowrap">
                    <span class="px-2 py-1 text-xs rounded-full bg-blue-100 text-blue-800">${rule.action}</span>
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-neutral-500">
                    <button class="text-blue-600 hover:text-blue-900 mr-3">Edit</button>
                    <button class="text-red-600 hover:text-red-900">Delete</button>
                </td>
            `;
            tbody.appendChild(row);
        });
    }

    updateFirewallRuleTable() {
        const tbody = document.getElementById('firewall-rules-table-body');
        const count = document.getElementById('firewall-rules-count');
        
        tbody.innerHTML = '';
        count.textContent = `${this.state.firewallRules.length} rules`;
        
        this.state.firewallRules.forEach(rule => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td class="px-6 py-4 whitespace-nowrap text-sm text-neutral-900">${rule.name}</td>
                <td class="px-6 py-4 whitespace-nowrap">
                    <span class="px-2 py-1 text-xs rounded-full ${rule.action === 'accept' ? 'bg-green-100 text-green-800' : rule.action === 'drop' ? 'bg-red-100 text-red-800' : 'bg-yellow-100 text-yellow-800'}">${rule.action}</span>
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-neutral-900">${rule.protocol}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-neutral-500">${rule.source || '-'}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-neutral-500">${rule.destination || '-'}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-neutral-500">
                    <button class="text-blue-600 hover:text-blue-900 mr-3">Edit</button>
                    <button class="text-red-600 hover:text-red-900">Delete</button>
                </td>
            `;
            tbody.appendChild(row);
        });
    }

    updateStaticRouteTable() {
        const tbody = document.getElementById('static-routes-table-body');
        const count = document.getElementById('static-routes-count');
        
        tbody.innerHTML = '';
        count.textContent = `${this.state.staticRoutes.length} routes`;
        
        this.state.staticRoutes.forEach(route => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td class="px-6 py-4 whitespace-nowrap text-sm text-neutral-900">${route.destination}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-neutral-900">${route.gateway}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-neutral-900">${route.interface}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-neutral-900">${route.metric}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-neutral-500">
                    <button class="text-blue-600 hover:text-blue-900 mr-3">Edit</button>
                    <button class="text-red-600 hover:text-red-900">Delete</button>
                </td>
            `;
            tbody.appendChild(row);
        });
    }

    updateBridgeTable() {
        const tbody = document.getElementById('bridges-table-body');
        const count = document.getElementById('bridges-count');
        
        tbody.innerHTML = '';
        count.textContent = `${this.state.bridges.length} bridges`;
        
        this.state.bridges.forEach(bridge => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td class="px-6 py-4 whitespace-nowrap text-sm text-neutral-900">${bridge.name}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-neutral-900">${bridge.ip_address || '-'}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-neutral-500">${bridge.interfaces}</td>
                <td class="px-6 py-4 whitespace-nowrap">
                    <span class="px-2 py-1 text-xs rounded-full ${bridge.stp_enabled ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-800'}">
                        ${bridge.stp_enabled ? 'Enabled' : 'Disabled'}
                    </span>
                </td>
                <td class="px-6 py-4 whitespace-nowrap">
                    <span class="px-2 py-1 text-xs rounded-full bg-green-100 text-green-800">${bridge.status}</span>
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-neutral-500">
                    <button class="text-blue-600 hover:text-blue-900 mr-3">Edit</button>
                    <button class="text-red-600 hover:text-red-900">Delete</button>
                </td>
            `;
            tbody.appendChild(row);
        });
    }

    // Notification system
    showNotification(message, type = 'info') {
        // Remove existing notifications
        const existingNotification = document.querySelector('.notification-toast');
        if (existingNotification) {
            existingNotification.remove();
        }

        const notification = document.createElement('div');
        notification.className = `notification-toast fixed top-4 right-4 px-4 py-3 rounded-lg shadow-lg z-50 transition-all duration-300 ${
            type === 'success' ? 'bg-green-100 text-green-800 border border-green-200' :
            type === 'error' ? 'bg-red-100 text-red-800 border border-red-200' :
            'bg-blue-100 text-blue-800 border border-blue-200'
        }`;
        
        notification.innerHTML = `
            <div class="flex items-center space-x-2">
                <i class="fa-solid ${
                    type === 'success' ? 'fa-check-circle' :
                    type === 'error' ? 'fa-exclamation-circle' :
                    'fa-info-circle'
                }"></i>
                <span>${message}</span>
            </div>
        `;
        
        document.body.appendChild(notification);
        
        // Auto-remove after 3 seconds
        setTimeout(() => {
            notification.style.opacity = '0';
            notification.style.transform = 'translateX(100%)';
            setTimeout(() => notification.remove(), 300);
        }, 3000);
    }

    loadInitialData() {
        // Initialize with empty data - data loading disabled to prevent HTTP operations
        this.updateVlanTable();
        this.updateNatRuleTable();
        this.updateFirewallRuleTable();
        this.updateStaticRouteTable();
        this.updateBridgeTable();
        
        console.log('[ADVANCED-NETWORK] Initial data loaded (demo mode)');
    }
}

// Initialize the advanced network section
function initializeAdvancedNetworkSection() {
    console.log('[ADVANCED-NETWORK] Starting initialization...');
    if (!window.advancedNetworkSection) {
        window.advancedNetworkSection = new AdvancedNetworkSection();
        console.log('[ADVANCED-NETWORK] Advanced Network Section initialized successfully');
    } else {
        console.log('[ADVANCED-NETWORK] Advanced Network Section already initialized');
    }
}

// Handle both cases: DOM ready vs already loaded
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initializeAdvancedNetworkSection);
} else {
    // DOM is already loaded, initialize immediately
    initializeAdvancedNetworkSection();
}

// Add manual test function for debugging
window.testAdvancedNetworkPopups = function() {
    console.log('[ADVANCED-NETWORK] Testing popup functionality manually...');
    
    if (window.advancedNetworkSection) {
        console.log('[ADVANCED-NETWORK] Advanced Network Section instance found');
        
        // Test each popup
        console.log('[ADVANCED-NETWORK] Testing VLAN popup...');
        window.advancedNetworkSection.showVlanPopup();
        
        setTimeout(() => {
            console.log('[ADVANCED-NETWORK] Testing NAT rule popup...');
            window.advancedNetworkSection.hideVlanPopup();
            window.advancedNetworkSection.showNatRulePopup();
        }, 2000);
        
        setTimeout(() => {
            console.log('[ADVANCED-NETWORK] Testing Firewall rule popup...');
            window.advancedNetworkSection.hideNatRulePopup();
            window.advancedNetworkSection.showFirewallRulePopup();
        }, 4000);
        
        setTimeout(() => {
            console.log('[ADVANCED-NETWORK] Testing Static route popup...');
            window.advancedNetworkSection.hideFirewallRulePopup();
            window.advancedNetworkSection.showStaticRoutePopup();
        }, 6000);
        
        setTimeout(() => {
            console.log('[ADVANCED-NETWORK] Testing Bridge popup...');
            window.advancedNetworkSection.hideStaticRoutePopup();
            window.advancedNetworkSection.showBridgePopup();
        }, 8000);
        
        setTimeout(() => {
            window.advancedNetworkSection.hideBridgePopup();
            console.log('[ADVANCED-NETWORK] Popup testing completed');
        }, 10000);
        
    } else {
        console.error('[ADVANCED-NETWORK] Advanced Network Section instance not found!');
    }
};

console.log('[ADVANCED-NETWORK] Test function available: window.testAdvancedNetworkPopups()');
</script>
